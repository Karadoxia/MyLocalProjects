{"instruction": "As a defender, how would you detect this attack?", "input": "Attacker is using Kerberoasting against service accounts in Active Directory.", "output": "Kerberoasting detection strategy: 1) Event ID 4769 monitoring - look for TGS requests with encryption type 0x17 (RC4) from unusual sources. 2) Volume anomaly - single user requesting many TGS tickets in short timeframe. 3) Request pattern - tickets for accounts the user doesn't normally access. 4) Honeypot accounts - create fake SPN accounts with monitoring, any TGS request is suspicious. 5) Service account activity baseline - detect when accounts are queried but never actually used. Implementation: Create detection rule in SIEM: 'More than 5 TGS requests from single IP in 5 minutes targeting different SPNs'. Prevention: Use gMSA with automatic password rotation, disable RC4 encryption for Kerberos, implement AES-only policy. Ensure service account passwords are 25+ characters."}
{"instruction": "Defend against lateral movement techniques.", "input": "Attacker has compromised one workstation and will try to move laterally. What controls stop them?", "output": "Lateral movement containment strategy: 1) Network segmentation - workstations shouldn't reach each other directly. Block SMB (445), RPC (135), WinRM (5985/5986) between workstations. 2) LAPS deployment - unique local admin passwords per machine. 3) Disable LLMNR/NBT-NS - prevents poisoning attacks for credential capture. 4) Credential Guard - protects LSASS memory on Windows 10+. 5) Privileged Access Workstations - admin credentials never touch regular workstations. 6) SMB signing - prevents relay attacks. 7) Windows Firewall rules - restrict inbound connections. Detection: 1) Monitor for new remote logon types (Type 3, 10) between workstations. 2) Track authentication failures across multiple systems. 3) Alert on admin tool execution (psexec, wmiexec signatures). Most impactful: Network segmentation + LAPS defeats 90% of common lateral movement."}
{"instruction": "Build detection for command and control traffic.", "input": "How do you detect C2 beaconing in network traffic?", "output": "C2 beacon detection approaches: 1) Time-based analysis - C2 often beacons at regular intervals. Look for periodic connections (jitter helps attackers evade but patterns remain). 2) Domain reputation - newly registered domains, DGA patterns, low popularity scores. 3) Certificate anomalies - self-signed, mismatched CN, Let's Encrypt on internal-looking names. 4) Traffic volume patterns - small regular outbound, occasional larger responses. 5) DNS analytics - high volume of DNS requests to single domain, TXT record abuse, long subdomain names. 6) JA3/JA3S fingerprints - match against known C2 frameworks (Cobalt Strike, Covenant, etc.). 7) User-agent anomalies - uncommon or malformed user-agents. Implementation: Deploy Zeek/Suricata with community detection rules. Use threat intel feeds for IOC matching. Machine learning for baseline deviation. Prioritize egress filtering - if users don't need direct internet, proxy everything."}
{"instruction": "Incident response for suspected domain compromise.", "input": "Alerts suggest attacker has Domain Admin. What's the containment playbook?", "output": "Domain Admin compromise response - CRITICAL INCIDENT: IMMEDIATE (First 30 minutes): 1) Confirm compromise scope - which DA accounts affected. 2) Disable compromised accounts - don't delete, disable. 3) Block attacker IPs at perimeter if known. 4) Isolate known compromised systems. DO NOT: Reset krbtgt yet - need investigation first. NEXT 4 HOURS: 1) Check DC authentication logs for lateral movement. 2) Identify persistence mechanisms - scheduled tasks, new accounts, GPO modifications. 3) Review recent GPO changes, AdminSDHolder modifications. 4) Check for Golden Ticket indicators (TGT lifetime anomalies). 5) Preserve evidence before changes. RECOVERY: 1) Reset krbtgt password TWICE (12+ hours apart). 2) Reset all privileged account passwords. 3) Review all trust relationships. 4) Audit every DA/EA/Schema Admin member. 5) Check for skeleton key / DCShadow artifacts. Consider: Full domain rebuild if persistence unclear."}
{"instruction": "Harden Active Directory against common attacks.", "input": "New AD environment being built. What security configurations should be implemented from day one?", "output": "AD security baseline - build it right: TIER MODEL: 1) Implement tiered administration - Tier 0 (DC/identity), Tier 1 (servers), Tier 2 (workstations). 2) Privileged Access Workstations for admin tasks. 3) Just-in-time admin via MIM PAM or similar. AUTHENTICATION: 1) Disable NTLM where possible, monitor where not. 2) Enable Credential Guard on all Windows 10+. 3) LAPS for local admin passwords. 4) gMSA for service accounts. 5) Enforce Kerberos AES encryption. MONITORING: 1) Deploy Advanced Audit Policy - enable DS Access, Logon events, Auth Policy changes. 2) Forward security logs to SIEM. 3) Protected Users group for sensitive accounts. 4) AdminSDHolder monitoring. NETWORK: 1) Disable SMBv1. 2) Require SMB signing. 3) Segment DCs on restricted VLAN. 4) Disable LLMNR, NBT-NS, WPAD. QUICK WINS: Disable print spooler on DCs, remove unnecessary SPNs, audit GPO permissions, enable LDAP signing."}
