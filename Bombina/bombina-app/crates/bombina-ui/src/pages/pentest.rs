//! Main Pentest Page
//! 
//! The primary interface for conducting penetration tests.

use dioxus::prelude::*;
use bombina_core::types::{ChatMessage, Target};
use crate::components::{ChatPanel, TargetInput, ToolsPanel};

/// Pentest page props
#[derive(Props, Clone, PartialEq)]
pub struct PentestPageProps {
    /// Current target value
    pub target_value: String,
    /// Current target (validated)
    pub current_target: Option<Target>,
    /// Chat messages
    pub messages: Vec<ChatMessage>,
    /// Whether AI is loading
    pub is_loading: bool,
    /// Whether a tool is executing
    pub is_executing: bool,
    /// Target validation message
    pub target_validation: Option<String>,
    /// Is target valid
    pub target_valid: bool,
    /// Callbacks
    pub on_target_change: EventHandler<String>,
    pub on_target_submit: EventHandler<Target>,
    pub on_send_message: EventHandler<String>,
    pub on_tool_select: EventHandler<(String, String)>,
    pub on_tool_execute: EventHandler<String>,
}

/// Main pentest page
#[component]
pub fn PentestPage(props: PentestPageProps) -> Element {
    rsx! {
        div {
            class: "pentest-page",
            style: "
                display: flex;
                height: 100%;
                gap: 16px;
                padding: 16px;
            ",

            // Main content area
            div {
                style: "
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    min-width: 0;
                ",

                // Target input
                TargetInput {
                    value: props.target_value.clone(),
                    on_change: props.on_target_change.clone(),
                    on_submit: props.on_target_submit.clone(),
                    is_valid: props.target_valid,
                    validation_message: props.target_validation.clone(),
                }

                // Chat panel
                div {
                    style: "flex: 1; min-height: 0;",
                    ChatPanel {
                        messages: props.messages.clone(),
                        is_loading: props.is_loading,
                        on_send: props.on_send_message.clone(),
                    }
                }
            }

            // Tools panel (right sidebar)
            div {
                style: "
                    width: 320px;
                    min-width: 280px;
                ",
                ToolsPanel {
                    target: props.current_target.as_ref().map(|t| t.value.clone()),
                    on_tool_select: props.on_tool_select.clone(),
                    on_tool_execute: props.on_tool_execute.clone(),
                    is_executing: props.is_executing,
                }
            }
        }
    }
}
